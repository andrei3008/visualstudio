generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(cuid())
  email        String    @unique
  name         String?
  passwordHash String
  createdAt    DateTime  @default(now())
  projects     Project[]
  assignedTasks Task[]   @relation("TaskAssignee")
}

enum ProjectStatus {
  new
  in_progress
  scoping
  review
  done
}

model Project {
  id        String         @id @default(cuid())
  user      User           @relation(fields: [userId], references: [id])
  userId    String
  name      String
  status    ProjectStatus  @default(new)
  createdAt DateTime       @default(now())
  tasks     Task[]
  milestones Milestone[]

  @@index([userId])
}

enum TaskStatus {
  todo
  in_progress
  done
}

model Task {
  id         String      @id @default(cuid())
  project    Project     @relation(fields: [projectId], references: [id])
  projectId  String
  title      String
  status     TaskStatus  @default(todo)
  assignee   User?       @relation("TaskAssignee", fields: [assigneeId], references: [id])
  assigneeId String?
  dueAt      DateTime?
  estimateH  Int?
  createdAt  DateTime    @default(now())

  @@index([projectId])
  @@index([assigneeId])
}

enum MilestoneStatus {
  planned
  in_progress
  done
}

model Milestone {
  id         String           @id @default(cuid())
  project    Project          @relation(fields: [projectId], references: [id])
  projectId  String
  title      String
  status     MilestoneStatus  @default(planned)
  dueAt      DateTime?
  createdAt  DateTime         @default(now())

  @@index([projectId])
}
